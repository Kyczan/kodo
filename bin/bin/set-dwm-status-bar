#!/bin/bash

# load scripts
scripts=$HOME/bin/dwm-status-bar
get_temperature=$scripts/get-temperature
get_battery=$scripts/get-battery
get_volume=$scripts/get-volume
get_weather=$scripts/get-weather
get_date_time=$scripts/get-date-time
get_updates=$scripts/get-updates

# initialize counters
COUNTER1=0
COUNTER2=0
COUNTER3=0

function set_bar() {
	xsetroot -name "$TEMP$BAT$VOL$WEATHER$DATE$UPDATES"
}

TEMP=$($get_temperature)
BAT=$($get_battery)
VOL=$($get_volume)
WEATHER=$($get_weather)
DATE=$($get_date_time)
UPDATES=$($get_updates)

set_bar

while true
do

	# update only every 5m
	if [[ "${COUNTER1}" -eq 300 ]]; then
		COUNTER1=0
		WEATHER=$($get_weather)
	fi;

	# update only every 1m
	if [[ "${COUNTER2}" -eq 60 ]]; then
		COUNTER2=0
		UPDATES=$($get_updates)
	fi;

	# update only every 20s
	if [[ "${COUNTER3}" -eq 20 ]]; then
		COUNTER3=0
		TEMP=$($get_temperature)
		BAT=$($get_battery)
	fi;
	
	# update every 1s
	VOL=$($get_volume)
	DATE=$($get_date_time)
	
    set_bar

	# increment counters
	COUNTER1=$((COUNTER1+1))
	COUNTER2=$((COUNTER2+1))
	COUNTER3=$((COUNTER3+1))

	sleep 1s
done &
